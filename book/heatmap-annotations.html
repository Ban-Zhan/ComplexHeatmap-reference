<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>ComplexHeatmap Complete Reference</title>
  <meta name="description" content="This book is a complete reference to ComplexHeatmap pacakge.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="ComplexHeatmap Complete Reference" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-book/" />
  <meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-book/complexheatmap-cover.jpg" />
  <meta property="og:description" content="This book is a complete reference to ComplexHeatmap pacakge." />
  <meta name="github-repo" content="jokergoo/ComplexHeatmap_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ComplexHeatmap Complete Reference" />
  
  <meta name="twitter:description" content="This book is a complete reference to ComplexHeatmap pacakge." />
  <meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-book/complexheatmap-cover.jpg" />

<meta name="author" content="Zuguang Gu">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="single-heatmap.html">
<link rel="next" href="making-a-list-of-heatmaps.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Circular Visualization in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#general-design"><i class="fa fa-check"></i><b>0.1</b> General design</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#vignettes"><i class="fa fa-check"></i><b>0.2</b> Vignettes</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="single-heatmap.html"><a href="single-heatmap.html"><i class="fa fa-check"></i><b>1</b> Single Heatmap</a><ul>
<li class="chapter" data-level="1.1" data-path="single-heatmap.html"><a href="single-heatmap.html#colors"><i class="fa fa-check"></i><b>1.1</b> Colors</a></li>
<li class="chapter" data-level="1.2" data-path="single-heatmap.html"><a href="single-heatmap.html#titles"><i class="fa fa-check"></i><b>1.2</b> Titles</a></li>
<li class="chapter" data-level="1.3" data-path="single-heatmap.html"><a href="single-heatmap.html#clustering"><i class="fa fa-check"></i><b>1.3</b> Clustering</a><ul>
<li class="chapter" data-level="1.3.1" data-path="single-heatmap.html"><a href="single-heatmap.html#distance-methods"><i class="fa fa-check"></i><b>1.3.1</b> Distance methods</a></li>
<li class="chapter" data-level="1.3.2" data-path="single-heatmap.html"><a href="single-heatmap.html#clustering-methods"><i class="fa fa-check"></i><b>1.3.2</b> Clustering methods</a></li>
<li class="chapter" data-level="1.3.3" data-path="single-heatmap.html"><a href="single-heatmap.html#render-dendrograms"><i class="fa fa-check"></i><b>1.3.3</b> Render dendrograms</a></li>
<li class="chapter" data-level="1.3.4" data-path="single-heatmap.html"><a href="single-heatmap.html#reorder-dendrograms"><i class="fa fa-check"></i><b>1.3.4</b> Reorder dendrograms</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="single-heatmap.html"><a href="single-heatmap.html#row-and-column-orders"><i class="fa fa-check"></i><b>1.4</b> Row and column orders</a></li>
<li class="chapter" data-level="1.5" data-path="single-heatmap.html"><a href="single-heatmap.html#seriation"><i class="fa fa-check"></i><b>1.5</b> Seriation</a></li>
<li class="chapter" data-level="1.6" data-path="single-heatmap.html"><a href="single-heatmap.html#dimension-names"><i class="fa fa-check"></i><b>1.6</b> Dimension names</a><ul>
<li class="chapter" data-level="1.6.1" data-path="single-heatmap.html"><a href="single-heatmap.html#split-by-k-means-clustering"><i class="fa fa-check"></i><b>1.6.1</b> Split by k-means clustering</a></li>
<li class="chapter" data-level="1.6.2" data-path="single-heatmap.html"><a href="single-heatmap.html#split-by-categorical-variables"><i class="fa fa-check"></i><b>1.6.2</b> Split by categorical variables</a></li>
<li class="chapter" data-level="1.6.3" data-path="single-heatmap.html"><a href="single-heatmap.html#graphic-parameters-for-splitting"><i class="fa fa-check"></i><b>1.6.3</b> Graphic parameters for splitting</a></li>
<li class="chapter" data-level="1.6.4" data-path="single-heatmap.html"><a href="single-heatmap.html#split-by-dendrogram"><i class="fa fa-check"></i><b>1.6.4</b> Split by dendrogram</a></li>
<li class="chapter" data-level="1.6.5" data-path="single-heatmap.html"><a href="single-heatmap.html#titles-for-splitting"><i class="fa fa-check"></i><b>1.6.5</b> Titles for splitting</a></li>
<li class="chapter" data-level="1.6.6" data-path="single-heatmap.html"><a href="single-heatmap.html#gaps-between-slices"><i class="fa fa-check"></i><b>1.6.6</b> Gaps between slices</a></li>
<li class="chapter" data-level="1.6.7" data-path="single-heatmap.html"><a href="single-heatmap.html#split-the-heatmap-annotations"><i class="fa fa-check"></i><b>1.6.7</b> Split the heatmap annotations</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="single-heatmap.html"><a href="single-heatmap.html#heatmap-as-raster-image"><i class="fa fa-check"></i><b>1.7</b> Heatmap as raster image</a></li>
<li class="chapter" data-level="1.8" data-path="single-heatmap.html"><a href="single-heatmap.html#customize-the-heatmap-body"><i class="fa fa-check"></i><b>1.8</b> Customize the heatmap body</a></li>
<li class="chapter" data-level="1.9" data-path="single-heatmap.html"><a href="single-heatmap.html#size-of-the-heatmap"><i class="fa fa-check"></i><b>1.9</b> Size of the heatmap</a></li>
<li class="chapter" data-level="1.10" data-path="single-heatmap.html"><a href="single-heatmap.html#plot-the-heatmap"><i class="fa fa-check"></i><b>1.10</b> Plot the heatmap</a></li>
<li class="chapter" data-level="1.11" data-path="single-heatmap.html"><a href="single-heatmap.html#get-orders-and-dendrograms"><i class="fa fa-check"></i><b>1.11</b> Get orders and dendrograms</a></li>
<li class="chapter" data-level="1.12" data-path="single-heatmap.html"><a href="single-heatmap.html#subset-a-heatmap"><i class="fa fa-check"></i><b>1.12</b> Subset a heatmap</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html"><i class="fa fa-check"></i><b>2</b> Heatmap Annotations</a><ul>
<li class="chapter" data-level="2.1" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation"><i class="fa fa-check"></i><b>2.1</b> Simple annotation</a></li>
<li class="chapter" data-level="2.2" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#simple-annotation-as-an-annotation-function"><i class="fa fa-check"></i><b>2.2</b> Simple annotation as an annotation function</a></li>
<li class="chapter" data-level="2.3" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#empty-annotation"><i class="fa fa-check"></i><b>2.3</b> Empty annotation</a></li>
<li class="chapter" data-level="2.4" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#image-annotation"><i class="fa fa-check"></i><b>2.4</b> Image annotation</a></li>
<li class="chapter" data-level="2.5" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#points-annotation"><i class="fa fa-check"></i><b>2.5</b> Points annotation</a></li>
<li class="chapter" data-level="2.6" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#lines-annotation"><i class="fa fa-check"></i><b>2.6</b> Lines annotation</a></li>
<li class="chapter" data-level="2.7" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#barplot-annotation"><i class="fa fa-check"></i><b>2.7</b> Barplot annotation</a></li>
<li class="chapter" data-level="2.8" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#boxplot-annotation"><i class="fa fa-check"></i><b>2.8</b> Boxplot annotation</a></li>
<li class="chapter" data-level="2.9" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#histogram-annotation"><i class="fa fa-check"></i><b>2.9</b> histogram annotation</a></li>
<li class="chapter" data-level="2.10" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#density-annotation"><i class="fa fa-check"></i><b>2.10</b> Density annotation</a></li>
<li class="chapter" data-level="2.11" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#joyplot-annotation"><i class="fa fa-check"></i><b>2.11</b> Joyplot annotation</a></li>
<li class="chapter" data-level="2.12" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#horizon-chart-annotation"><i class="fa fa-check"></i><b>2.12</b> Horizon chart annotation</a></li>
<li class="chapter" data-level="2.13" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#text-annotation"><i class="fa fa-check"></i><b>2.13</b> Text annotation</a></li>
<li class="chapter" data-level="2.14" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#mark-annotation"><i class="fa fa-check"></i><b>2.14</b> Mark annotation</a></li>
<li class="chapter" data-level="2.15" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#multiple-annotations"><i class="fa fa-check"></i><b>2.15</b> Multiple annotations</a></li>
<li class="chapter" data-level="2.16" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#summary-annotation"><i class="fa fa-check"></i><b>2.16</b> Summary annotation</a></li>
<li class="chapter" data-level="2.17" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#utility-functions"><i class="fa fa-check"></i><b>2.17</b> Utility functions</a></li>
<li class="chapter" data-level="2.18" data-path="heatmap-annotations.html"><a href="heatmap-annotations.html#implement-new-annotation-function"><i class="fa fa-check"></i><b>2.18</b> Implement new annotation function</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html"><i class="fa fa-check"></i><b>3</b> Making A List of Heatmaps</a><ul>
<li class="chapter" data-level="3.1" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#titles-1"><i class="fa fa-check"></i><b>3.1</b> Titles</a></li>
<li class="chapter" data-level="3.2" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#size-of-heatmaps"><i class="fa fa-check"></i><b>3.2</b> Size of heatmaps</a></li>
<li class="chapter" data-level="3.3" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#gap-between-heatmaps"><i class="fa fa-check"></i><b>3.3</b> Gap between heatmaps</a></li>
<li class="chapter" data-level="3.4" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#auto-adjustment-to-the-main-heatmap"><i class="fa fa-check"></i><b>3.4</b> Auto adjustment to the main heatmap</a></li>
<li class="chapter" data-level="3.5" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#control-row-in-draw-function"><i class="fa fa-check"></i><b>3.5</b> control row … in draw() function</a></li>
<li class="chapter" data-level="3.6" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#annotation-as-components-are-adjusted"><i class="fa fa-check"></i><b>3.6</b> Annotation as components are adjusted</a></li>
<li class="chapter" data-level="3.7" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#concatenate-with-annotations"><i class="fa fa-check"></i><b>3.7</b> concatenate with annotations</a></li>
<li class="chapter" data-level="3.8" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#only-annotations"><i class="fa fa-check"></i><b>3.8</b> Only annotations</a></li>
<li class="chapter" data-level="3.9" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#vertical-align"><i class="fa fa-check"></i><b>3.9</b> vertical align</a></li>
<li class="chapter" data-level="3.10" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#retrieve-orders-and-dendrograms"><i class="fa fa-check"></i><b>3.10</b> Retrieve orders and dendrograms</a></li>
<li class="chapter" data-level="3.11" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#change-graphic-parameters-simultaneously"><i class="fa fa-check"></i><b>3.11</b> Change graphic parameters simultaneously</a></li>
<li class="chapter" data-level="3.12" data-path="making-a-list-of-heatmaps.html"><a href="making-a-list-of-heatmaps.html#session-info"><i class="fa fa-check"></i><b>3.12</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="legend.html"><a href="legend.html"><i class="fa fa-check"></i><b>4</b> Legend</a><ul>
<li class="chapter" data-level="4.1" data-path="legend.html"><a href="legend.html#continuous-legend"><i class="fa fa-check"></i><b>4.1</b> Continuous legend</a></li>
<li class="chapter" data-level="4.2" data-path="legend.html"><a href="legend.html#discrete-legend"><i class="fa fa-check"></i><b>4.2</b> Discrete legend</a></li>
<li class="chapter" data-level="4.3" data-path="legend.html"><a href="legend.html#a-list-of-legends"><i class="fa fa-check"></i><b>4.3</b> A list of legends</a></li>
<li class="chapter" data-level="4.4" data-path="legend.html"><a href="legend.html#heatmap-and-annotation-legends"><i class="fa fa-check"></i><b>4.4</b> Heatmap and annotation legends</a></li>
<li class="chapter" data-level="4.5" data-path="legend.html"><a href="legend.html#to-add-customized-legend."><i class="fa fa-check"></i><b>4.5</b> To add customized legend.</a></li>
<li class="chapter" data-level="4.6" data-path="legend.html"><a href="legend.html#legends-setting-for-the-heatmaps"><i class="fa fa-check"></i><b>4.6</b> legends setting for the heatmaps</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html"><i class="fa fa-check"></i><b>5</b> Heatmap decoration</a><ul>
<li class="chapter" data-level="5.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#decorate_-functions"><i class="fa fa-check"></i><b>5.1</b> decorate_* functions</a></li>
<li class="chapter" data-level="5.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a><ul>
<li class="chapter" data-level="5.2.1" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#barplot-for-single-column-heatmap"><i class="fa fa-check"></i><b>5.2.1</b> Barplot for single column heatmap</a></li>
<li class="chapter" data-level="5.2.2" data-path="heatmap-decoration.html"><a href="heatmap-decoration.html#add-decoration-for-a-customized-heatmap"><i class="fa fa-check"></i><b>5.2.2</b> add decoration for a customized heatmap</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="oncoprint.html"><a href="oncoprint.html"><i class="fa fa-check"></i><b>6</b> OncoPrint</a><ul>
<li class="chapter" data-level="6.1" data-path="oncoprint.html"><a href="oncoprint.html#general-settings"><i class="fa fa-check"></i><b>6.1</b> General settings</a></li>
<li class="chapter" data-level="6.2" data-path="oncoprint.html"><a href="oncoprint.html#apply-to-cbioportal-dataset"><i class="fa fa-check"></i><b>6.2</b> Apply to cBioPortal dataset</a></li>
<li class="chapter" data-level="6.3" data-path="oncoprint.html"><a href="oncoprint.html#session-info-1"><i class="fa fa-check"></i><b>6.3</b> Session info</a></li>
<li class="chapter" data-level="6.4" data-path="oncoprint.html"><a href="oncoprint.html#density-heatmap"><i class="fa fa-check"></i><b>6.4</b> density heatmap</a></li>
<li class="chapter" data-level="6.5" data-path="oncoprint.html"><a href="oncoprint.html#stacked-plot"><i class="fa fa-check"></i><b>6.5</b> stacked plot</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html"><i class="fa fa-check"></i><b>7</b> More Examples of Making Complex Heatmaps</a><ul>
<li class="chapter" data-level="7.0.1" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#add-more-information-for-gene-expression-matrix"><i class="fa fa-check"></i><b>7.0.1</b> Add more information for gene expression matrix</a></li>
<li class="chapter" data-level="7.0.2" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#visualize-genomic-regions-and-other-correspondance"><i class="fa fa-check"></i><b>7.0.2</b> Visualize genomic regions and other correspondance</a></li>
<li class="chapter" data-level="7.1" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#combine-pvclust-and-heatmap"><i class="fa fa-check"></i><b>7.1</b> Combine pvclust and heatmap</a></li>
<li class="chapter" data-level="7.2" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#make-a-same-plot-as-heatmap"><i class="fa fa-check"></i><b>7.2</b> Make a same plot as heatmap()</a></li>
<li class="chapter" data-level="7.3" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#the-measles-vaccine-heatmap"><i class="fa fa-check"></i><b>7.3</b> The measles vaccine heatmap</a></li>
<li class="chapter" data-level="7.4" data-path="more-examples-of-making-complex-heatmaps.html"><a href="more-examples-of-making-complex-heatmaps.html#session-info-2"><i class="fa fa-check"></i><b>7.4</b> Session info</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ComplexHeatmap Complete Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="heatmap-annotations" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Heatmap Annotations</h1>
<p>Heatmap annotations are important components of a heatmap that it shows additional information that associates with rows or columns in the heatmap. <strong>ComplexHeatmap</strong> package provides very flexible supports for setting annotations or defining new annotation graphics. The annotations can be put on the four sides of the heatmap, by <code>top_annotation</code>, <code>bottom_annotation</code>, <code>left_annotation</code> and <code>right_annotation</code> arguments.</p>
<p>The value for the four arguments should be in the <code>HeatmapAnnotation</code> class and should be constructed by <code>HeatmapAnnotation()</code>, or by <code>rowAnnotation()</code> if it is row annotation. (<code>rowAnnotation()</code> is just a helper function which is identical to <code>HeatmapAnnotation(..., which = &quot;row&quot;)</code>) A simple usage of annotations is as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
mat =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)
column_ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo1 =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">bar1 =</span> <span class="kw">anno_barplot</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))
row_ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo2 =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">bar2 =</span> <span class="kw">anno_barplot</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))
<span class="kw">Heatmap</span>(mat, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> column_ha, <span class="dt">right_annotation =</span> row_ha)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Or assign as bottom annotation and left annotation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Heatmap</span>(mat, <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">bottom_annotation =</span> column_ha, <span class="dt">left_annotation =</span> row_ha)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>In above examples, for <code>column_ha</code> and <code>row_ha</code>, both have two annotations where <code>foo1</code> and <code>foo2</code> are numeric vectors and <code>bar1</code> and <code>bar2</code> are barplots. The vector-like annotation is called <em>“simple annotation”</em> here and the barplot annotation is called <em>“complex annotation”</em>. You can already see the annotations must be defined as name-value pairs (e.g. <code>foo = ...</code>).</p>
<p>Heatmap annotations can also be independent of the heatmaps. They can be concatenated to the heatmap list by <code>+</code> if it is horizontal or <code>%v%</code> if it is vertical. Next chapter will discuss how to concatenate heatmaps/annotations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code only for demonstration</span>
<span class="kw">Heatmap</span>(...) <span class="op">+</span><span class="st"> </span><span class="kw">rowAnnotation</span>() <span class="op">+</span><span class="st"> </span>...
<span class="kw">Heatmap</span>(...) <span class="op">%v%</span><span class="st"> </span><span class="kw">HeatmapAnnotation</span>(...) <span class="op">+</span><span class="st"> </span>...</code></pre></div>
<p><code>HeatmapAnnotation()</code> returns a <code>HeatmapAnnotation</code> class object. The object is usually composed of several annotations. If following sections of this chapter, we first introduce settings for individal annotation, and later we show how to put them toghether.</p>
<p>You can see the information of the <code>column_ha</code> and <code>row_ha</code> objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">column_ha</code></pre></div>
<pre><code>## A HeatmapAnnotation object with 2 annotations
##   name: heatmap_annotation_0 
##   position: column 
##   items: 10 
##   width: 1npc 
##   height: 15mm 
##   this object is  subsetable
##   5.92327473958333mm extension on the left 
##   9.47286783854167mm extension on the right 
## 
##  name   annotation_type color_mapping height
##  foo1 continuous vector        random    5mm
##  bar1    anno_barplot()                 10mm</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">row_ha</code></pre></div>
<pre><code>## A HeatmapAnnotation object with 2 annotations
##   name: heatmap_annotation_1 
##   position: row 
##   items: 10 
##   width: 15mm 
##   height: 1npc 
##   this object is  subsetable
##   9.95358072916666mm extension on the bottom 
## 
##  name   annotation_type color_mapping width
##  foo2 continuous vector        random   5mm
##  bar2    anno_barplot()                10mm</code></pre>
<p>In following examples in this chapter, we will only show the grapgics for the annotations with no heatmap, unless it is necessary. If you want to try it with a heatmap, you just assign the <code>HeatmapAnnotation</code> object which we always name as <code>ha</code> to <code>top_annotation</code>, <code>bottom_annotation</code>, <code>left_annotation</code> or <code>right_annotation</code> arguments.</p>
<p>Settings are basically the same for column annotations and row annotations. If there is nothing specicial, we only show the column annotation as examples. If you want to try row annotation, just add <code>which = &quot;row&quot;</code> to <code>HeatmapAnnotation()</code> or directly change to <code>rowAnnotation()</code> function.</p>
<div id="simple-annotation" class="section level2">
<h2><span class="header-section-number">2.1</span> Simple annotation</h2>
<p>A so-called <em>“simple annotation”</em> is the most used style of annotations which is heatmap-like or grid-like graphics where colors are used to map to the anntation values. To generate a simple annotation, you just simply put the annotation vector in <code>HeatmapAnnotation()</code> with a specific name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-9-1.png" width="576" /></p>
<p>Or a discrete annotation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-11-1.png" width="576" /></p>
<p>If colors are not specified, colors are randomly generated. To set the colors for annotation, <code>col</code> needs to be set as a named list. For continuous values, the color mapping should be a color mapping function generated by <code>circlize::colorRamp2()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(circlize)
col_fun =<span class="st"> </span><span class="kw">colorRamp2</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>))
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-13-1.png" width="576" /></p>
<p>And for discrete annotations, the color should be a named vector where names correspond to the levels in the annotation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-15-1.png" width="576" /></p>
<p>If you specify more than one vectors, there will be multiple annotations (<code>foo</code> and <code>bar</code> in following example). Also you can see how <code>col</code> is set when <code>foo</code> and <code>bar</code> are all put into a single <code>HeatmapAnnotation()</code>. Maybe you can understand now the names in the color list is actually used to map to the annotation names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(
    <span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    )
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-17-1.png" width="576" /></p>
<p>The color for <code>NA</code> value is controlled by <code>na_col</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(
    <span class="dt">foo =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>), 
    <span class="dt">bar =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">9</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    ),
    <span class="dt">na_col =</span> <span class="st">&quot;black&quot;</span>
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-19-1.png" width="576" /></p>
<p><code>gp</code> mainly controls the graphic parameters for the borders of the grids.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(
    <span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    ),
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-21-1.png" width="576" /></p>
<p>The simple annotation can also be a matrix (numeric or character) that all the columns in the matrix share a same color mapping schema. <strong>Note columns in the matrix correspond to the rows in the column annotation.</strong> Also the column names of the matrix are used as the annotation names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dt">a =</span> <span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">b =</span> <span class="kw">runif</span>(<span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-23-1.png" width="576" /></p>
<p>If the matrix has no column name, the name of the annotation is still used, but drawn in the middle of the annotation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="kw">runif</span>(<span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-25-1.png" width="576" /></p>
<p>As simple annotations can be in different modes (e.g. numeric, or character), they can be combined as a data frame and send to <code>df</code> argument. Imaging in your project, you might already have an annotation table, you can directly set it by <code>df</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anno_df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,
    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">df =</span> anno_df,
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    )
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-27-1.png" width="576" /></p>
<p>Single annotations and data frame can be mixed. In following example, colors for <code>foo2</code> is not specified, random colors will be used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">df =</span> anno_df,
    <span class="dt">foo2 =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    )
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-29-1.png" width="576" /></p>
<p>The height of the simple annotation is controlled by <code>anno_simple_size</code> argument. Since all single annotations have same height, the value of <code>anno_simple_size</code> is a single <code>unit</code> value. Note there are arguments like <code>width</code>, <code>height</code>, <code>annotation_width</code> and <code>annotation_height</code>, but they are used to adjust the width/height when there are multiple annotations (which are always mix of simple annotations and complex annotations).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(
    <span class="dt">foo =</span> <span class="kw">cbind</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), 
    <span class="dt">bar =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
    <span class="dt">col =</span> <span class="kw">list</span>(<span class="dt">foo =</span> col_fun,
               <span class="dt">bar =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;b&quot;</span> =<span class="st"> &quot;green&quot;</span>, <span class="st">&quot;c&quot;</span> =<span class="st"> &quot;blue&quot;</span>)
    ),
    <span class="dt">anno_simple_size =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-31-1.png" width="576" /></p>
</div>
<div id="simple-annotation-as-an-annotation-function" class="section level2">
<h2><span class="header-section-number">2.2</span> Simple annotation as an annotation function</h2>
<p><code>HeatmapAnnotation()</code> supports <em>“complex annotation”</em> by setting the annotation as a function. The annotation function defines how to draw the graphics at a certain position corresponding to the column or row in the heatmap. There are quite a lot of annotation functions predefined in <strong>ComplexHeatmap</strong> package. In the end of this chapter, we will introduce how to construct your own annotation function by the <code>AnnotationFunction</code> class.</p>
<p>For all the annotation functions in forms of <code>anno_*()</code>, if it is specified in <code>HeatmapAnnotation()</code> or <code>rowAnnotation()</code>, you don’t need to do anything explicitly on <code>anno_*()</code> to tell it should be drawn on rows or columns. <code>anno_*()</code> automatically detects whether it is a row annotation environment or a column annotation environment.</p>
<p>The simple annotation shown in previous section is internally constructed by <code>anno_simple()</code> annotation function. However, directly using <code>anno_simple()</code> will not automatically generate legends for the final plot. However, it can provide more flexibility for more annotation graphics (note later chapter we will show, although the annotation functions cannot automatically generate the legends, the legends can be controlled and added to the final plot manually).</p>
<p>For an example in previous section:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code only for demonstration</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<p>is actually identical to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code only for demonstration</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</code></pre></div>
<p><code>anno_simple()</code> makes heatmap-like annotations (or the simple annotations). Basically if users only make heatmap-like annotations, they do not need to directly use <code>anno_simple()</code>, but this function allows to add more symbols on the annotation grids.</p>
<p><code>anno_simple()</code> allows to add “points” or single-letter symbols on top of the annotation grids. <code>pch</code>, <code>pt_gp</code> and <code>pt_size</code> control the settings of the points. The value of <code>pch</code> can be a vector with possible <code>NA</code> values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">1</span>, 
    <span class="dt">pt_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>), <span class="dt">pt_size =</span> <span class="kw">unit</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="st">&quot;mm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-35-1.png" width="576" /></p>
<p>Set <code>pch</code> as a vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-37-1.png" width="576" /></p>
<p>Set <code>pch</code> as a vector of letters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
    <span class="dt">pch =</span> <span class="kw">sample</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-39-1.png" width="576" /></p>
<p>Set <code>pch</code> as a vector with <code>NA</code> values (nothing is drawn for <code>NA</code> pch values):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">8</span>, <span class="ot">NA</span>, <span class="dv">10</span>, <span class="dv">11</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-41-1.png" width="576" /></p>
<p><code>pch</code> also works if the value for <code>anno_simple()</code> is a matrix; The length of <code>pch</code> should be as same as the number of matrix rows or columns or even the length of the matrix (the length of the matrix is the length of all data points in the matrix).</p>
<p>Lenght of <code>pch</code> corresponds to matrix columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-43-1.png" width="576" /></p>
<p>Lenght of <code>pch</code> corresponds to matrix rows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-45-1.png" width="576" /></p>
<p><code>pch</code> is a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pch =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">nc =</span> <span class="dv">2</span>)
pch[<span class="kw">sample</span>(<span class="kw">length</span>(pch), <span class="dv">10</span>)] =<span class="st"> </span><span class="ot">NA</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">pch =</span> pch))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-47-1.png" width="576" /></p>
<p>Till now, you might wonder how to set the legends of the symbols you’ve added to the simple annotations. Now We will show you a simple example and this functionality will be d…. In this example, we assume the simple annotations are kind of p-values and we add <code>*</code> for p-values less than 0.01.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
pvalue =<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="kw">runif</span>(<span class="dv">10</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">3</span>)
is_sig =<span class="st"> </span>pvalue <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.01</span>
pch =<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;*&quot;</span>, <span class="dv">10</span>)
pch[<span class="op">!</span>is_sig] =<span class="st"> </span><span class="ot">NA</span>
pvalue_col_fun =<span class="st"> </span><span class="kw">colorRamp2</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="co"># color mapping for -log10(pvalue)</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">pvalue =</span> <span class="kw">anno_simple</span>(<span class="op">-</span><span class="kw">log10</span>(pvalue), <span class="dt">col =</span> pvalue_col_fun, <span class="dt">pch =</span> pch),
    <span class="dt">annotation_name_side =</span> <span class="st">&quot;left&quot;</span>)
ht =<span class="st"> </span><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)
<span class="co"># see how we define the legend for pvalue</span>
lgd_pvalue =<span class="st"> </span><span class="kw">Legend</span>(<span class="dt">title =</span> <span class="st">&quot;p-value&quot;</span>, <span class="dt">col =</span> pvalue_col_fun, <span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), 
    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0.1&quot;</span>, <span class="st">&quot;0.01&quot;</span>, <span class="st">&quot;0.001&quot;</span>))
lgd_sig =<span class="st"> </span><span class="kw">Legend</span>(<span class="dt">pch =</span> <span class="st">&quot;*&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;points&quot;</span>, <span class="dt">labels =</span> <span class="st">&quot;&lt; 0.01&quot;</span>)
<span class="kw">draw</span>(ht, <span class="dt">annotation_legend_list =</span> <span class="kw">list</span>(lgd_pvalue, lgd_sig))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-49-1.png" width="504" /></p>
<p>The height of the simple annotation can be controled by <code>height</code> argument or <code>anno_simple_size</code> (or <code>width</code> if it is a row annotation) inside <code>anno_simple()</code>. <code>anno_simple_size</code> controls the size for single-row annotation and <code>height</code>/<code>width</code> controls the total height/width of all simple annotations. If <code>height</code>/<code>width</code> is set, <code>anno_simple_size</code> is ignored.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-52-1.png" width="576" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_simple</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="dt">anno_simple_size =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-54-1.png" width="576" /></p>
<p>For all the annotation functions we introduce later, the height or the width for individual annotations should all be set inside the <code>anno_*()</code> functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code for demonstration</span>
anno_<span class="op">*</span>(<span class="dt">width =</span> ...)
anno_<span class="op">*</span>(<span class="dt">height =</span> ...)</code></pre></div>
<p>Again, the <code>width</code>, <code>height</code>, <code>annotation_width</code> and <code>annotation_height</code> arguments in <code>HeatmapAnnotation()</code> are used to adjust the size of multiple annotations.</p>
</div>
<div id="empty-annotation" class="section level2">
<h2><span class="header-section-number">2.3</span> Empty annotation</h2>
<p><code>anno_empty()</code> is a place holder where nothing is drawn. Later graphics can be added by <code>decorate_annotation()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-57-1.png" width="576" /></p>
<p>In Chapter, we will introduce the use of the decoration functions, but here we give a quick example. In gene expression expression analysis, there are senarios that we split the heatmaps into several groups and we want to highlight some key genes in each group. In this case, we simply add the labels on the right side of the heatmap without aligning them to the their corresponding rows. (<code>anno_mark()</code> can align the labels correclty to their corresponding rows, but in the senario we show here, it is not necessray).</p>
<p>In following example, basically what we do is in each empty annotation, we add a segment and text.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">random_text =<span class="st"> </span><span class="cf">function</span>(n) {
    <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="cf">function</span>(i) {
        <span class="kw">paste0</span>(<span class="kw">sample</span>(letters, <span class="kw">sample</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span>)), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
    })
}
text_list =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">text1 =</span> <span class="kw">random_text</span>(<span class="dv">4</span>),
    <span class="dt">text2 =</span> <span class="kw">random_text</span>(<span class="dv">5</span>),
    <span class="dt">text3 =</span> <span class="kw">random_text</span>(<span class="dv">6</span>),
    <span class="dt">text4 =</span> <span class="kw">random_text</span>(<span class="dv">7</span>)
)
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">FALSE</span>, 
    <span class="dt">width =</span> <span class="kw">max_text_width</span>(<span class="kw">unlist</span>(text_list)) <span class="op">+</span><span class="st"> </span><span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>)))
<span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nrow =</span> <span class="dv">100</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">row_km =</span> <span class="dv">4</span>, <span class="dt">right_annotation =</span> ha)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {
    <span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, <span class="dt">slice =</span> i, {
        <span class="kw">grid.rect</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> i, <span class="dt">col =</span> <span class="ot">NA</span>), <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>)
        <span class="kw">grid.text</span>(<span class="kw">paste</span>(text_list[[i]], <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="dt">x =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;mm&quot;</span>), <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>)
    })
}</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-59-1.png" width="504" /></p>
<p>A second use of the empty annotation is to add complex annotation graphics where the empty annotation pretends to be a virtual plotting regions. You can construct an annotation function by <code>AnnotationFunction</code> class for complex annotation graphics, which allows subsetting and splitting, but still, it can be a secondary choice to directly draw inside the empty annotation, which is easier and faster for implementing rather graphics (but less flexible and does not allow splitting).</p>
<p>In following we show how to add a “complex version” of points annotation. The only thing that needs to be aware of is the location on x-axes (y-axes if it is a row annotation) should correspond to the column index after column reordering.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_empty</span>(<span class="dt">border =</span> <span class="ot">TRUE</span>, 
    <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>)))
ht =<span class="st"> </span><span class="kw">Heatmap</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dt">nrow =</span> <span class="dv">10</span>), <span class="dt">name =</span> <span class="st">&quot;mat&quot;</span>, <span class="dt">top_annotation =</span> ha)
ht =<span class="st"> </span><span class="kw">draw</span>(ht)
co =<span class="st"> </span><span class="kw">column_order</span>(ht)
value =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>)
<span class="kw">decorate_annotation</span>(<span class="st">&quot;foo&quot;</span>, {
    x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
    value =<span class="st"> </span>value[co]
    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">xscale =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">10.5</span>), <span class="dt">yscale =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))
    <span class="kw">grid.lines</span>(<span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">10.5</span>), <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">lty =</span> <span class="dv">2</span>),
        <span class="dt">default.units =</span> <span class="st">&quot;native&quot;</span>)
    <span class="kw">grid.points</span>(x, value, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">size =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>),
        <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="kw">ifelse</span>(value <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)), <span class="dt">default.units =</span> <span class="st">&quot;native&quot;</span>)
    <span class="kw">grid.yaxis</span>(<span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))
    <span class="kw">popViewport</span>()
})</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-60-1.png" width="504" /></p>
</div>
<div id="image-annotation" class="section level2">
<h2><span class="header-section-number">2.4</span> Image annotation</h2>
<p>Images can be added as annotations. <code>anno_image()</code> supports image formats in <code>png</code>, <code>svg</code>, <code>pdf</code>, <code>eps</code>, <code>jpeg/jpg</code>, <code>tiff</code>. <code>png</code>, <code>jpeg/jpg</code> and <code>tiff</code> images are imported by <code>png::readPNG()</code>, <code>jpeg::readJPEG()</code> and <code>tiff::readTIFF()</code>, and drawn by <code>grid::grid.raster()</code>. <code>svg</code> images are firstly reformatted by <code>rsvg::rsvg_svg()</code> and then imported by <code>grImport2::readPicture()</code> and drawn by <code>grImport2::grid.picture()</code>. <code>pdf</code> and <code>eps</code> images are imported by <code>grImport::PostScriptTrace()</code> and <code>grImport::readPicture()</code>, later drawn by <code>grImport::grid.picture()</code>.</p>
<p>The free icons for following examples are from <a href="https://github.com/Keyamoon/IcoMoon-Free" class="uri">https://github.com/Keyamoon/IcoMoon-Free</a>. A vector of image pathes are set as the first argument of <code>anno_image()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">image_png =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;~/Downloads/IcoMoon-Free-master/PNG/64px&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)
image_svg =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;~/Downloads/IcoMoon-Free-master/SVG/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)
image_eps =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;~/Downloads/IcoMoon-Free-master/EPS/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)
image_pdf =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">dir</span>(<span class="st">&quot;~/Downloads/IcoMoon-Free-master/PDF/&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>), <span class="dv">10</span>)

<span class="co"># we only draw the image annotation for PNG images, while the others are the same</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png))</code></pre></div>
<pre><code>## Loading required namespace: png</code></pre>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-63-1.png" width="576" /></p>
<p>Different image formats can be mixed in the input vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code is only for demonstration</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(<span class="kw">c</span>(image_png[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], image_svg[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], 
    image_eps[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], image_pdf[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])))</code></pre></div>
<p>Border and background colors can be set by <code>gp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-66-1.png" width="576" /></p>
<p><code>border</code> controls the border of the whole annotation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code only for deonstration</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, <span class="dt">border =</span> <span class="st">&quot;red&quot;</span>))</code></pre></div>
<p>Padding or space around the images is set by <code>space</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png, <span class="dt">space =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="st">&quot;mm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-69-1.png" width="576" /></p>
<p>If only some of the images need to be drawn, the other elements in the <code>image</code> vector can be set to <code>''</code> or <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">image_png[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] =<span class="st"> &quot;&quot;</span>
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_image</span>(image_png))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-71-1.png" width="576" /></p>
<p>The default height for column image annotation is <code>1cm</code>.</p>
</div>
<div id="points-annotation" class="section level2">
<h2><span class="header-section-number">2.5</span> Points annotation</h2>
<p>Points annotation shows distribution of a list of data points. The data points object <code>x</code> can be a single vector or a matrix. If it is a matrix, the graphic settings such as <code>pch</code>, <code>size</code> and <code>gp</code> can correpspond to matrix columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-73-1.png" width="576" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">20</span>), <span class="dt">nc =</span> <span class="dv">2</span>), 
    <span class="dt">pch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-75-1.png" width="576" /></p>
<p><code>ylim</code> controls the range on “y-axis” or the “data axis” (if it is a row annotation, the data axis is horizontal), <code>extend</code> controls the extended space on the data axis direction. <code>axis</code> controls whether to show the axis and <code>axis_param</code> controls the settings for axis. The default settings for axis are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">default_axis_param</span>(<span class="st">&quot;column&quot;</span>)</code></pre></div>
<pre><code>## $at
## NULL
## 
## $labels
## NULL
## 
## $labels_rot
## [1] 0
## 
## $gp
## $fontsize
## [1] 8
## 
## 
## $side
## [1] &quot;left&quot;
## 
## $facing
## [1] &quot;outside&quot;</code></pre>
<p>And you can overwrite some of them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_points</span>(<span class="kw">runif</span>(<span class="dv">10</span>), 
    <span class="dt">axis_param =</span> <span class="kw">list</span>(
        <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>,
        <span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), 
        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;half&quot;</span>, <span class="st">&quot;one&quot;</span>)
    ))
)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-78-1.png" width="576" /></p>
<p>The configuration of axis is same for other annotation functions which have axes.</p>
<p>The default height of the column points annotation is <code>1cm</code>.</p>
</div>
<div id="lines-annotation" class="section level2">
<h2><span class="header-section-number">2.6</span> Lines annotation</h2>
<p><code>anno_lines()</code> connects the data points by a list of segments. Similar as <code>anno_points()</code>, the data variable can be a numeric vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">runif</span>(<span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-80-1.png" width="576" /></p>
<p>Or a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>)), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>),
  <span class="dt">add_points =</span> <span class="ot">TRUE</span>, <span class="dt">pt_gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">6</span>), <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">16</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-82-1.png" width="576" /></p>
<p>Smoothed lines (by <code>loess()</code>) can be added instead of the original lines by setting <code>smooth = TRUE</code>, but it should be used with caution because the order of columns in the heatmap is used as “x-value” for the fitting and the order will change after the clustering of the heatmap.</p>
<p>Smoothing also works in the input data variable is a matrix that the smoothing is performed for each column separately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_lines</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dt">smooth =</span> <span class="ot">TRUE</span>, <span class="dt">add_points =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-84-1.png" width="576" /></p>
<p>The default height for column lines annotation is <code>1cm</code>.</p>
</div>
<div id="barplot-annotation" class="section level2">
<h2><span class="header-section-number">2.7</span> Barplot annotation</h2>
<p>The data points can be represented as barplots. Some of the arguments such as <code>ylim</code>, <code>axis</code>, <code>axis_param</code> are same as <code>anno_points()</code> that users can refer to the documentation of <code>anno_barplot()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-86-1.png" width="576" /></p>
<p>The width of bars is controlled by <code>bar_width</code>. It is a relative value to the width of the cell in the heatmap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">bar_width =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-88-1.png" width="576" /></p>
<p>Graphic parameters are controlled by <code>gp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-90-1.png" width="576" /></p>
<p>You choose the baseline of bars by <code>baseline</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">baseline =</span> <span class="st">&quot;min&quot;</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-92-1.png" width="576" /></p>
<p>If the input value is a matrix, it will be represented as stacked barplots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">matrix</span>(<span class="dt">nc =</span> <span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>))))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-94-1.png" width="576" /></p>
<p>And length of parameters in <code>gp</code> can be the number of the columns in the matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">col =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-96-1.png" width="576" /></p>
<p>Following example shows a barplot annotation which visualizes a proportion matrix (for which row sums are 1).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">4</span><span class="op">*</span><span class="dv">10</span>), <span class="dt">nc =</span> <span class="dv">4</span>)
m =<span class="st"> </span><span class="kw">t</span>(<span class="kw">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) x<span class="op">/</span><span class="kw">sum</span>(x)))
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_barplot</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">5</span>), 
    <span class="dt">bar_width =</span> <span class="dv">1</span>, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-98-1.png" width="576" /></p>
<p>The default height for column barplot annotation is <code>1cm</code>.</p>
</div>
<div id="boxplot-annotation" class="section level2">
<h2><span class="header-section-number">2.8</span> Boxplot annotation</h2>
<p>Boxplot annotation as well as the annotation functions which are introduced later are more suitable for small matrice. You don’t want to put boxplots as column annotation for a matrix with 100 columns.</p>
<p>For <code>anno_boxplot()</code>, the input data variable should be a matrix or a list. If <code>x</code> is a matrix and if it is a column annotation, statistics for boxplots are calculated by columns, and if it is a row annotation, the calculation is done by rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">12345</span>)
m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dv">10</span>)
ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-100-1.png" width="576" /></p>
<p>Graphic parameters are controlled by <code>gp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-102-1.png" width="576" /></p>
<p>Width of the boxes are controlled by <code>box_width</code>. <code>outline</code> controls whether to show outlier points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_boxplot</span>(m, <span class="dt">height =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), 
    <span class="dt">box_width =</span> <span class="fl">0.9</span>, <span class="dt">outline =</span> <span class="ot">FALSE</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-104-1.png" width="576" /></p>
<p>The default height of column boxplot annotation is <code>2cm</code>.</p>
</div>
<div id="histogram-annotation" class="section level2">
<h2><span class="header-section-number">2.9</span> histogram annotation</h2>
<p>Annotations as histograms are more suitable to put as row annotations. The histogram annotation shows the distribution of each row by histograms. The setting for the data variable is the same as <code>anno_boxplot()</code> which can be a matrix or a list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nc =</span> <span class="dv">100</span>)
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m)) <span class="co"># apply `m` on rows</span></code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-106-1.png" width="166.299212598425" /></p>
<p>Number of breaks for histograms is controlled by <code>n_breaks</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m, <span class="dt">n_breaks =</span> <span class="dv">20</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-108-1.png" width="166.299212598425" /></p>
<p>Colors are controlled by <code>gp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_histogram</span>(m, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-110-1.png" width="166.299212598425" /></p>
<p>The default for column histogram annotation is <code>4cm</code>.</p>
</div>
<div id="density-annotation" class="section level2">
<h2><span class="header-section-number">2.10</span> Density annotation</h2>
<p>Similar as histogram annotations, <code>anno_density()</code> shows the distribution as a fitted curve.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-112-1.png" width="166.299212598425" /></p>
<p>The height of the density lines can be controlled to make the distribution look like a “joyplot”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">joyplot_scale =</span> <span class="dv">2</span>, 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="st">&quot;#CCCCCC80&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-114-1.png" width="166.299212598425" /></p>
<p>Or visualize the distribution as violin plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">type =</span> <span class="st">&quot;violin&quot;</span>, 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-116-1.png" width="166.299212598425" /></p>
<p>When there are too many rows, the space for normal density peaks might be too small. In this case, we can visualize the distribution by heatmaps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-118-1.png" width="241.889763779528" /></p>
<p>THe color schema for heatmap distribution is controlled by <code>heatmap_colors</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_density</span>(m, <span class="dt">type =</span> <span class="st">&quot;heatmap&quot;</span>, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">6</span>, <span class="st">&quot;cm&quot;</span>), 
    <span class="dt">heatmap_colors =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;orange&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-120-1.png" width="241.889763779528" /></p>
<p>In <strong>ComplexHeatmap</strong> package, there is a <code>densityHeatmap()</code> function which visualizes distribution as a heatmap (not an annotation).</p>
</div>
<div id="joyplot-annotation" class="section level2">
<h2><span class="header-section-number">2.11</span> Joyplot annotation</h2>
<p><code>anno_joyplot()</code> is specifical for so-called joyplot (<a href="http://blog.revolutionanalytics.com/2017/07/joyplots.html" class="uri">http://blog.revolutionanalytics.com/2017/07/joyplots.html</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nc =</span> <span class="dv">10</span>)
lt =<span class="st"> </span><span class="kw">apply</span>(m, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">data.frame</span>(<span class="kw">density</span>(x)[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]))
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_joyplot</span>(lt, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>), <span class="dt">transparency =</span> <span class="fl">0.75</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-122-1.png" width="166.299212598425" /></p>
<p>Or only show the lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">5000</span>), <span class="dt">nc =</span> <span class="dv">50</span>)
lt =<span class="st"> </span><span class="kw">apply</span>(m, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">data.frame</span>(<span class="kw">density</span>(x)[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]))
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_joyplot</span>(lt, <span class="dt">width =</span> <span class="kw">unit</span>(<span class="dv">4</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fill =</span> <span class="ot">NA</span>), <span class="dt">scale =</span> <span class="dv">4</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-124-1.png" width="166.299212598425" /></p>
</div>
<div id="horizon-chart-annotation" class="section level2">
<h2><span class="header-section-number">2.12</span> Horizon chart annotation</h2>
<p><a href="https://flowingdata.com/2015/07/02/changing-price-of-food-items-and-horizon-graphs/">Horizon chart</a> as annotation can only be added as row annotation. The value for <code>anno_horizon()</code> should be a list or a matrix where matrix columns correspond to rows in the annotation.</p>
<p>The default style of horizon chart annotation is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lt =<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="cf">function</span>(x) <span class="kw">cumprod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">1000</span>, <span class="op">-</span>x<span class="op">/</span><span class="dv">100</span>, x<span class="op">/</span><span class="dv">100</span>)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-126-1.png" width="166.299212598425" /></p>
<p>Colors for positive values and negative values are controlled by <code>pos_fill</code> and <code>neg_fill</code> in <code>gar()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">pos_fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">neg_fill =</span> <span class="st">&quot;darkgreen&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-128-1.png" width="166.299212598425" /></p>
<p><code>pos_fill</code> and <code>neg_fill</code> can be assigned as a vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, 
    <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">pos_fill =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">each =</span> <span class="dv">10</span>),
              <span class="dt">neg_fill =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="dt">each =</span> <span class="dv">10</span>))))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-130-1.png" width="166.299212598425" /></p>
<p>Whether the peaks for negative values start from the bottom or the top?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, <span class="dt">negative_from_top =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-132-1.png" width="166.299212598425" /></p>
<p>The space between every two neighbouring charts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_horizon</span>(lt, <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;mm&quot;</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-134-1.png" width="166.299212598425" /></p>
</div>
<div id="text-annotation" class="section level2">
<h2><span class="header-section-number">2.13</span> Text annotation</h2>
<p>Text can be used as annotations by <code>anno_text()</code>. Graphic parameters are controlled by <code>gp</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fontsize =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span><span class="op">+</span><span class="dv">4</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-136-1.png" width="113.524360236221" /></p>
<p>Locationsn are controlled by <code>location</code> and <code>just</code>. Rotation is controlled by <code>rot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_text</span>(month.name, <span class="dt">location =</span> <span class="dv">1</span>, <span class="dt">rot =</span> <span class="dv">45</span>, 
    <span class="dt">just =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">fontsize =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span><span class="op">+</span><span class="dv">4</span>)))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-138-1.png" width="88.0762462362247" /></p>
</div>
<div id="mark-annotation" class="section level2">
<h2><span class="header-section-number">2.14</span> Mark annotation</h2>
<p>Sometimes there are many rows or columns in the heatmap and we want to mark some of them. <code>anno_mark()</code> is used to mark subset of rows or columns and connect labels with lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">nrow =</span> <span class="dv">100</span>)
ha =<span class="st"> </span><span class="kw">rowAnnotation</span>(<span class="dt">foo =</span> <span class="kw">anno_mark</span>(<span class="dt">at =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">60</span>, <span class="dv">97</span><span class="op">:</span><span class="dv">100</span>), <span class="dt">labels =</span> month.name[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]))
<span class="kw">Heatmap</span>(m, <span class="dt">cluster_rows =</span> <span class="ot">FALSE</span>, <span class="dt">right_annotation =</span> ha)</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
</div>
<div id="multiple-annotations" class="section level2">
<h2><span class="header-section-number">2.15</span> Multiple annotations</h2>
<p>As mentioned before, to put multiple annotations in <code>HeatmapAnnotation()</code>, they just need to be specified as name-value pairs. In <code>HeatmapAnnotation()</code>, there are some arguments which controls multiple annotations. For these arguments, they are specified as a vector which has same length as number of the annotations, or a named vector with subset of the annotations.</p>
<p>The simple annotations which are specified as vectors, matrices and data frames will automatically have legends on the heatmap. <code>show_legend</code> controls whether draw the legend for them. Note here if <code>show_legend</code> is a vector, <strong>the length of <code>show_legend</code> should be the same as the simple annotations while not the number of all annotations.</strong></p>
<p><code>gp</code> controls graphic parameters (except <code>fill</code>) for the simple annotatios, such as the border of annotation grids.</p>
<p><code>border</code> controls the border of every single annotations. <code>show_annotation_name</code> controls whether show annotation names. As mentioned, the value can be a single value, a vector or a named vector. <code>annotation_name_gp</code>, <code>annotation_name_offset</code>, <code>annotation_name_side</code> and <code>annotation_name_rot</code> controls the style and positions of the annotation names.</p>
<p><code>gap</code> controls the space between every two neighbouring annotations. The value can be a single unit or a vector of units.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),
    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),
    <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-141-1.png" width="576" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ha =<span class="st"> </span><span class="kw">HeatmapAnnotation</span>(<span class="dt">foo =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
    <span class="dt">bar =</span> <span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">1</span>),
    <span class="dt">pt =</span> <span class="kw">anno_points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>),
    <span class="dt">gap =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="st">&quot;mm&quot;</span>))</code></pre></div>
<p><img src="03-heatmap_annotation_files/figure-html/unnamed-chunk-143-1.png" width="576" /></p>
<p><code>height</code>, <code>width</code>, <code>annotation_height</code> and <code>annotation_width</code> control the height or width of the heatmap annotations. Normally you don’t need to set it because all the single annotations have fixed height/width and the final height/width for the whole heatmap annotation is the sum of them plus the sum of gaps. …</p>
</div>
<div id="summary-annotation" class="section level2">
<h2><span class="header-section-number">2.16</span> Summary annotation</h2>
</div>
<div id="utility-functions" class="section level2">
<h2><span class="header-section-number">2.17</span> Utility functions</h2>
</div>
<div id="implement-new-annotation-function" class="section level2">
<h2><span class="header-section-number">2.18</span> Implement new annotation function</h2>
<p>A normal R function defines how to draw the annotation graphics. As expected, the main part of the <code>AnnotationFunction</code> class is this function. The function defines how to draw at specific positions which correspond to rows or columns in the heatmap. The function should have three arguments: <code>index</code>, <code>k</code> and <code>n</code> (the names of the arguments can be arbitory) where <code>k</code> and <code>n</code> are optional. <code>index</code> corresponds to the indices of rows or columns of the heatmap. The value of <code>index</code> is not necessarily to be the whole row indices or column indices. It can also be a subset of the indices if the annotation is split into slices according to the split of the heatmap. The value in <code>index</code> is always sorted according to the reordering of heatmap rows or columns (e.g. by clustering). So, <code>index</code> actually contains a list of row or column indices for the current slice after row or column reordering. This type of design makes sure the annotation graphics are drawn at the correct positions and can be correctly corresponded to the heatmap rows or columns.</p>
<p>As mentioned, annotation can be split into slices. <code>k</code> corresponds to the current slice and <code>n</code> corresponds to the total number of slices. The information of <code>k</code> and <code>n</code> sometimes can be useful, for example, we want to add axis in the annotation, and if it is a column annotation and axis is drawn on the very right of the annotation area, the axis is only drawn when <code>k == n</code>.</p>
<p>Since the function only allows <code>index</code>, <code>k</code> and <code>n</code>, the function sometimes uses several external variables which can not be defined inside the function, e.g. the data points for the annotation. These variables should be imported into the AnnotationFunction class so that the function can correctly find these variables.</p>
<p>One important feature for AnnotationFunction class is it can be subsetable. To allow subsetting of the object, users need to define the rule for the imported variables if there is any. The rules are simple function which accpets the variable and indices, and returns the subset of the variable. The subset rule functions implemented in this package are <code>subset_gp</code>, <code>subset_matrix_by_row</code> and <code>subset_vector</code>. These three functions are enough for most of the cases.</p>
<p>In following, we defined three AnnotationFunction objects:</p>
<ol style="list-style-type: decimal">
<li>It needs external variable and support subsetting</li>
</ol>
<p>x = 1:10 anno1 = AnnotationFunction( fun = function(index) { n = length(index) pushViewport(viewport()) grid.points(1:n, x[index]) popViewport() }, var_imported = list(x = x), n = 10, subset_rule = list(x = subset_vector), subsetable = TRUE )</p>
<ol start="2" style="list-style-type: decimal">
<li>The data variable is defined inside the function and no need to import other variables.</li>
</ol>
<p>anno2 = AnnotationFunction( fun = function(index) { x = 1:10 n = length(index) pushViewport(viewport()) grid.points(1:n, x[index]) popViewport() }, n = 10, subsetable = TRUE )</p>
<ol start="3" style="list-style-type: decimal">
<li>The most compact way to only specify the function to the constructor.</li>
</ol>
<p>anno3 = AnnotationFunction( fun = function(index) { x = 1:10 n = length(index) pushViewport(viewport()) grid.points(1:n, x[index]) popViewport() } )</p>
<p>Finally, you need to push a viewport for graphics and finally pop the viewport.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="single-heatmap.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="making-a-list-of-heatmaps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jokergoo/circlize_book/edit/master/03-heatmap_annotation.Rmd",
"text": "Edit"
},
"download": ["ComplexHeatmap-book.pdf", "ComplexHeatmap-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
